Prepare disks:
# parted /dev/vdX mklabel gpt unit TB mkpart primary 0% 100%
# mkfs.xfs /dev/vdX1
# mkdir -p /mnt/disk1
# mount /dev/vdX1 /mnt/disk1
# echo "/dev/vdX1 /mnt/disk1 xfs defaults 1 2" >> /etc/fstab
---
# dnf install -y iscsi-initiator-utils
# systemctl start iscsid
# systemctl enable iscsid

# dnf install -y nfs-utils

# helm repo add longhorn https://charts.longhorn.io
# helm repo update

# helm show values longhorn/longhorn > longhorn-values.yaml

# kubectl create namespace longhorn-system
# export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
# helm install longhorn longhorn/longhorn --values longhorn-values.yaml --namespace longhorn-system

# helm upgrade longhorn longhorn/longhorn --values longhorn-values.yaml --namespace longhorn-system

# kubectl -n longhorn-system get pod

---
# kubectl create -f https://raw.githubusercontent.com/longhorn/longhorn/v1.1.2/examples/storageclass.yaml

# vi longhorn-storageclass.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: longhorn-storageclass
  namespace: longhorn-system
data:
  storageclass.yaml: |
    kind: StorageClass
    apiVersion: storage.k8s.io/v1
    metadata:
      name: longhorn-r1
    provisioner: driver.longhorn.io
    allowVolumeExpansion: true
    reclaimPolicy: Delete
    volumeBindingMode: Immediate
    parameters:
      numberOfReplicas: "1"
      dataLocality: "best-effort"
      staleReplicaTimeout: "2880"
      fromBackup: ""
    #  backingImage: "bi-test"
    #  backingImageURL: "https://backing-image-example.s3-region.amazonaws.com/test-backing-image"
    #  diskSelector: "ssd,fast"
    #  nodeSelector: "storage,fast"
    #  recurringJobs: '[{"name":"snap", "task":"snapshot", "cron":"*/1 * * * *", "retain":1},
    #                   {"name":"backup", "task":"backup", "cron":"*/2 * * * *", "retain":1,
    #                    "labels": {"interval":"2m"}}]'

# kubectl apply -f longhorn-storageclass.yaml
# kubectl get configmap longhorn-storageclass -n longhorn-system -o json

---
Uninstall:

# helm uninstall longhorn longhorn/longhorn --namespace longhorn-system
