Prepare disks:
# parted /dev/vdX mklabel gpt unit TB mkpart primary 0% 100%
# mkfs.xfs /dev/vdX1
# mkdir -p /mnt/data1
# mount /dev/vdX1 /mnt/data1
# echo "/dev/vdX1 /mnt/data1 xfs defaults 1 2" >> /etc/fstab
---
# dnf install -y iscsi-initiator-utils
# dnf install -y nfs-utils

# helm repo add longhorn https://charts.longhorn.io
# helm repo update

# helm show values longhorn/longhorn > longhorn-values.yaml
# vi longhorn-values.yaml

defaultClassReplicaCount: 1

type: LoadBalancer

# kubectl create namespace longhorn-system
# export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
# helm install longhorn longhorn/longhorn --values longhorn-values.yaml --namespace longhorn-system

# kubectl -n longhorn-system get pod

---

# vi longhorn-storageclass.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: longhorn-storageclass
  namespace: longhorn-system
data:
  storageclass.yaml: |
    kind: StorageClass
    apiVersion: storage.k8s.io/v1
    metadata:
      name: longhorn-replica-1
    provisioner: driver.longhorn.io
    allowVolumeExpansion: true
    reclaimPolicy: Delete
    volumeBindingMode: Immediate
    parameters:
      numberOfReplicas: "1"
      staleReplicaTimeout: "30"
      fromBackup: ""

# kubectl apply -f longhorn-storageclass.yaml
# kubectl get configmap longhorn-storageclass -n longhorn-system -o json

---
Uninstall:

# helm uninstall longhorn longhorn/longhorn --namespace longhorn-system
