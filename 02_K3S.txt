K3S HA installation

On first master node:
Kube-VIP setup https://kube-vip.io/usage/k3s/
# mkdir -p /var/lib/rancher/k3s/server/manifests/
# curl https://kube-vip.io/manifests/rbac.yaml > /var/lib/rancher/k3s/server/manifests/rbac.yaml

# export VIP=x.x.x.x
# export INTERFACE=ethx
# curl -sL kube-vip.io/k3s | vipAddress=$VIP vipInterface=$INTERFACE sh | sudo tee /var/lib/rancher/k3s/server/manifests/vip.yaml

# curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--write-kubeconfig-mode 644 \
-t agent-secret --tls-san $VIP --disable servicelb" sh -s - server --cluster-init
------------------
Other master nodes:

# export VIP=x.x.x.x
# export INTERFACE=ethx
# curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--write-kubeconfig-mode 644 \
-t agent-secret --tls-san $VIP" sh -s - server https://<ip or hostname of server1>:6443
---------------
Kube-vip Cloud Provider installation
https://kube-vip.io/usage/on-prem/

# kubectl apply -f https://raw.githubusercontent.com/kube-vip/kube-vip-cloud-provider/main/manifest/kube-vip-cloud-controller.yaml
# kubectl delete configmap --namespace kube-system kubevip

# kubectl create configmap --namespace kube-system kubevip --from-literal cidr-global=X.X.X.X/X
or
# kubectl create configmap --namespace kube-system kubevip --from-literal range-global=X.X.X.X-X.X.X.X

-------------------------------
Check status:
# kubectl get all --all-namespaces
# kubectl get node -o wide
# k3s kubectl get pods --all-namespaces
# kubectl get endpoints -n kube-system

Show leader:
# kubectl get endpoints kube-controller-manager --namespace=kube-system -o yaml

-------------------------------
Uninstall K3S
Server:
# /usr/local/bin/k3s-uninstall.sh

Agent:
# /usr/local/bin/k3s-agent-uninstall.sh
----------------------------------
